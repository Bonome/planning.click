<script context="module">
    export async function preload(page) {
        const {slug} = page.params;

        const resDays = await this.fetch('planning/'+slug+'/days.json', {method: 'get'});
        const dataDays = await resDays.json();

        const response = await this.fetch('planning/' + slug + '.json', {method: 'get'});
        const data = await response.json();
        let users = data.users;
        let days = data.week.days;
        let firstDayOfTheWeek = data.week.dayOne;
        let disabledDays = data.week.disabled;
        return {users, days, firstDayOfTheWeek, disabledDays, dataDays, slug};
    }
</script>
<script>
    import { onMount } from "svelte";

    import { conf } from '../../conf.js';
    import Month from '../../components/Month.html';

    // su, mo, tu, we, th, fr, sa
//    let days = [0, 1, 2, 3, 4, 5, 6];
//    let firstDayOfTheWeek = 1;
//    let disabledDays = [0, 6];
//    let slug = slug;//'tenderspage';
    export let slug;
    export let days = [];
    export let firstDayOfTheWeek;
    export let disabledDays = [];
    export let users = [];
    export let dataDays = [];

    const initPlanning = {
        name: 'TendersPage',
        slug: 'tenderspage',
        users: [{
                name: 'Julien',
                role: 'admin',
                id: 1
            }, {
                name: 'Bruno',
                role: 'admin',
                id: 2
            }, {
                name: 'User 3',
                role: 'user',
                id: 3
            }],
        week: {
            dayOne: 1,
            days: [0, 1, 2, 3, 4, 5, 6],
            disabled: [0, 6]
        },
        off: {

        },
        custom: {

        }
    }


    const create = function () {
        console.log('post');
        let url = 'planning/tenderspage.json';
        fetch(url, {
            method: 'POST',
            body: JSON.stringify(initPlanning),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(r => {
            r.json()
                    .then(function (result) {
                        // The data is posted: do something with the result...
                    })
        }).catch(err => {
            // POST error: do something...
            console.log('POST error', err.message)
        });
    }



</script>
<style>
</style>

<svelte:head>
    <title>Planning</title>
</svelte:head>

<!--<button on:click='{create}'>init db test tenderspage</button>-->
{#if days.length > 0 }
<Month {users} {firstDayOfTheWeek} {days} {disabledDays} {dataDays} {slug}></Month>
{/if}