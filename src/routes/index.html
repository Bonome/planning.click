<script context="module">
    export async function preload(page) {
        console.log(page);
        const {host} = page;
        return {host};
    }
</script>
<script>
    import { _ } from 'svelte-i18n';
    import { goto } from '@sapper/app'

    import { conf } from '../conf.js';

    export let host;
    let gotoHref = '';
    const initPlanning = {
        name: '',
        slug: '',
        users: [{
                name: 'Admin 1',
                role: 'admin',
                id: 1
            }, {
                name: 'User 2',
                role: 'admin',
                id: 2
            }, {
                name: 'User 3',
                role: 'user',
                id: 3
            }],
        week: {
            dayOne: 1,
            days: [0, 1, 2, 3, 4, 5, 6],
            disabled: [0, 6]
        },
        off: {

        }
    }


    const create = function () {
        console.log('post');
        let url = 'planning/tenderspage.json';
        fetch(url, {
            method: 'POST',
            body: JSON.stringify(initPlanning),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(r => {
            r.json()
                    .then(function (result) {
                        // The data is posted: do something with the result...
                    })
        }).catch(err => {
            // POST error: do something...
            console.log('POST error', err.message)
        });
    }



</script>
<style>
</style>

<svelte:head>
    <title>Planning</title>
</svelte:head>

<button on:click='{create}'>Create a new planning</button>
<input bind:value="{initPlanning.name}"/>
<p>{$_('index.url_access')}</p>
<p><a href="http://{host}/{initPlanning.slug=initPlanning.name.toLowerCase()}">http://{host}/{initPlanning.slug=initPlanning.name.toLowerCase()}</a></p>
<button on:click='{goto(gotoHref)}'>Go to this planning</button>
<input bind:value="{gotoHref}"/>